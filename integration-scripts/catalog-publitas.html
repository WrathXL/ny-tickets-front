<!-- Externals scripts -->
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
  crossorigin="anonymous"
></script>

<!-- Integration script -->
<script>
  window.viewerReady = function (api, platform) {
    // Initializations

    // * Add bootstrap css
    document.body.insertAdjacentHTML(
      "beforeend",
      '<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">'
    );

    function createModalDiv() {
      // Creates a modal element with an iframe of the cart page inside
      const div = document.createElement("div");
      div.classList.add("modal");
      div.classList.add("fade");
      div.setAttribute("id", "modal");
      div.setAttribute("tabindex", "-1");
      div.setAttribute("aria-labelledby", "modalLabel");
      div.setAttribute("aria-hidden", "true");

      div.innerHTML = `
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="modalLabel">Your cart items</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <iframe src="http://localhost:9000/cart/" width="100%" height="100%"></iframe>
            </div>
        </div>
      </div>
        `;
      return div;
    }

    // Viewer API

    // * Cart button on the sidebar
    api.setCartButtonAction(function () {
      const modalDiv = createModalDiv();
      document.body.appendChild(modalDiv);
      const modal = new bootstrap.Modal("#modal");
      modalDiv.addEventListener("hidden.bs.modal", function () {
        modalDiv.remove();
      });
      modal.show();
    }, "See cart items");

    // * CTA on product detail page
    api.setProductAction(function (products, onOpen, onClose) {
      var url = `http://localhost:9000/product/${products[0].webshopIdentifier}`; // create a URL based on products
      console.log(products);
      onOpen(); // update the address bar and browser title

      // show custom product page
      api
        .showExternalContent(url, { width: "600px" })
        // revert the address bar and browser title once iframe is closed
        .on("close", onClose);
    });
  };
</script>
